[tox]
envlist = e2e
skipsdist = True
isolated_build = False

[testenv]
# Base configuration for all test environments
deps =
    pytest>=8.0.0
    pytest-asyncio>=0.23.0
    pytest-timeout>=2.2.0
    httpx  # Version controlled by services for integration tests
    asyncpg>=0.29.0
    boto3>=1.34.0
    protobuf>=4.25.0
    alembic>=1.17.1
    cryptography>=42.0.0
    psycopg2-binary>=2.9.0  # Required for Alembic migrations with SQLAlchemy
    sqlalchemy>=2.0.0  # Required for Alembic
    ../shared/python/payments_proto  # Install payments_proto as editable package

passenv =
    AWS_*
    DATABASE_URL
    TEST_DATABASE_URL

setenv =
    AWS_ENDPOINT_URL = http://localhost:4566
    AWS_ACCESS_KEY_ID = test
    AWS_SECRET_ACCESS_KEY = test
    AWS_REGION = us-east-1
    PYTHONPATH = {toxinidir}/..::{toxinidir}/../shared/python::{toxinidir}/../shared/python/payments_proto

[testenv:e2e]
description = Run end-to-end tests with Docker containers
commands =
    pytest e2e/test_full_e2e.py -v -m e2e {posargs}

[testenv:quick]
description = Run a quick smoke test
commands =
    pytest e2e/test_full_e2e.py::test_full_e2e_happy_path -v {posargs}
